# Step 000007: Code Constructs Extraction and Indexing

## Overview
Create a new `code_constructs` table to store extracted programming constructs (functions, classes, variables) with their own embeddings for more granular search capabilities.

## Context
While file-level search is useful, developers often need to find specific functions or classes. By extracting and indexing individual code constructs, we can provide much more precise search results.

## Implementation Tasks

### 1. Database Schema Creation
- Create the `code_constructs` table as specified in the design
- Add indexes for efficient querying by construct type and file relationships
- Implement foreign key relationships to the `code_files` table
- Add migration logic to create the table in existing databases

### 2. AST-Based Code Extraction
- Create `code_construct_extractor.py` module
- Implement construct extraction for Python:
  - Functions (with parameters, return types, docstrings)
  - Classes (with inheritance, methods)
  - Global variables and constants
  - Import statements
- Add support for JavaScript/TypeScript:
  - Functions and arrow functions
  - Classes and prototypes
  - Exports and imports
  - Interface definitions (TypeScript)

### 3. Construct Embedding Generation
- Generate separate embeddings for each extracted construct
- Use construct signature + docstring + surrounding context for embedding
- Store construct embeddings in the new table alongside metadata
- Optimize embedding generation to avoid redundant processing

### 4. Integration with Indexing Pipeline
- Update indexing operations to extract and store constructs
- Ensure construct extraction happens after file metadata extraction
- Add progress tracking for construct processing
- Handle parse errors gracefully without breaking indexing

## Success Criteria
- [ ] `code_constructs` table is created and properly indexed
- [ ] Functions and classes are extracted from Python files with accurate metadata
- [ ] Each construct has its own embedding for semantic search
- [ ] Construct extraction integrates smoothly with existing indexing process
- [ ] Database relationships are properly maintained

## Files to Create/Modify
- `code_construct_extractor.py` - New module for AST-based extraction
- `database_manager.py` - Add construct table creation and migration
- `indexing_operations.py` - Integrate construct extraction
- `tests/test_construct_extraction.py` - Test extraction accuracy

## Dependencies
- Step 000006 must be completed (snippet extraction foundation)

## Technical Notes
- Use Python's built-in `ast` module for Python parsing
- Consider using `typescript` npm package via subprocess for TS parsing
- Store construct signatures in a normalized format for consistent searching
- Balance extraction depth vs. performance - focus on most commonly searched constructs

## Estimated Effort
8-10 hours