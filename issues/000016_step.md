# Step 000016: Hybrid Search Implementation (Semantic + Exact)

## Overview
Implement hybrid search capabilities that combine semantic similarity with exact text matching to provide comprehensive and flexible search results.

## Context
While semantic search is powerful for finding code by meaning, developers sometimes need exact text matches or keyword searches. A hybrid approach provides the best of both worlds.

## Implementation Tasks

### 1. Full-Text Search Integration
- Add full-text search capabilities using DuckDB's FTS extension
- Create full-text indexes for file content and code constructs
- Implement exact keyword matching with stemming and fuzzy matching
- Support Boolean search operators (AND, OR, NOT, quotes for exact phrases)

### 2. Hybrid Search Algorithm
- Create `hybrid_search.py` module
- Implement search result fusion algorithms:
  - Reciprocal Rank Fusion (RRF) for combining semantic and text results
  - Weighted score combination with configurable weights
  - Adaptive weighting based on query characteristics
- Add search mode selection (semantic-only, text-only, hybrid)

### 3. Query Preprocessing and Routing
- Implement smart query routing based on query analysis
- Detect when exact matching is preferred (quoted strings, regex patterns)
- Handle mixed queries that contain both semantic and exact components
- Add query expansion for semantic searches with related terms

### 4. Advanced Search Features
- Support regex search patterns for power users
- Add wildcard and partial matching capabilities
- Implement search within specific file types or directories
- Add date range filtering for recently modified code

## Success Criteria
- [ ] Hybrid search provides better results than semantic-only search for diverse queries
- [ ] Exact text matching works reliably for quoted strings and specific keywords
- [ ] Search fusion algorithms produce well-balanced result rankings
- [ ] Advanced search features work correctly without degrading performance

## Files to Create/Modify
- `hybrid_search.py` - New module for hybrid search implementation
- `search_operations.py` - Integrate hybrid search capabilities
- `database_manager.py` - Add full-text search indexes
- `mcp_server.py` - Add hybrid search options to MCP tools
- `tests/test_hybrid_search.py` - Test hybrid search effectiveness

## Dependencies
- Step 000015 must be completed (relationship mapping foundation)

## Technical Notes
- Use DuckDB's FTS extension for full-text search capabilities
- Implement configurable fusion algorithms to tune result quality
- Consider query performance impact of maintaining multiple indexes
- Design hybrid search to gracefully degrade if one component fails

## Estimated Effort
6-7 hours